<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=2C5971170CD50D071D8444DDD87E68CD" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:FooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=01F89A31F1103BC3B9A3B2562E9C41B3" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Invoke ScriptNotify event when we click a button inside a WebView</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Invoke ScriptNotify event when we click a button inside a WebView</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Store Apps
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            WebView
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Windows RT
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">1/21/2015</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p>In Windows Store apps is possible to use a WebView control to show web pages and sometimes we may need to intercept between the web page and the code behind of the XAML page, to do others task based in the action.</p>
<p>There are some changes from Windows 8.0 to Windows 8.1 related with the WebView control. These differences can be find here
<a href="http://blogs.windows.com/buildingapps/2013/07/17/whats-new-in-webview-in-windows-8-1/">
What&rsquo;s new in WebView in Windows 8.1</a>&nbsp;and there is an interesting sample:&nbsp;<a href="https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://code.msdn.microsoft.com/windowsapps/How-to-intercept-854d33da">How to intercept JavaScript alert in WebView in universal Windows apps</a>&nbsp;from&nbsp;<a title="Go to OneCode Team's profile" href="https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://social.msdn.microsoft.com/profile/onecode%20team/" >OneCode
 Team</a>. In this sample, we will see a solution for when we click a button from a web page hosted in a WebView.</p>
<p>&nbsp;</p>
<h1><span>Building the Sample</span></h1>
<p><em><em>You only need Visual Studio 2013 and Windows 8.1.</em></em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p>To start, we need to create a Windows Store App, we can select the Blank Template, and then we need to create a basic html page with a button, as following:</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>HTML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">html</span>
<pre class="hidden">&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;button type=&quot;button&quot; id=&quot;MyButton&quot;&gt;Click here...&lt;/button&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<div class="preview">
<pre class="csharp">&lt;!DOCTYPE&nbsp;html&gt;&nbsp;
&nbsp;
&lt;html&nbsp;lang=<span class="cs__string">&quot;en&quot;</span>&nbsp;xmlns=<span class="cs__string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;&nbsp;
&lt;head&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=<span class="cs__string">&quot;utf-8&quot;</span>&nbsp;/&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;&nbsp;
&lt;/head&gt;&nbsp;
&lt;body&gt;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;type=<span class="cs__string">&quot;button&quot;</span>&nbsp;id=<span class="cs__string">&quot;MyButton&quot;</span>&gt;Click&nbsp;here...&lt;/button&gt;&nbsp;
&lt;/body&gt;&nbsp;
&lt;/html&gt;</pre>
</div>
</div>
</div>
<p>After it, we need to define a WebView in the MainPage.xaml, as following:</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>XAML</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">xaml</span>
<pre class="hidden">  &lt;WebView Name=&quot;WebView&quot;
                 Margin=&quot;100&quot;
                 NavigationCompleted=&quot;WebView_OnNavigationCompleted&quot;
                 ScriptNotify=&quot;WebView_OnScriptNotify&quot;
                 Source=&quot;ms-appx-web:///HtmlPage.html&quot; /&gt;</pre>
<div class="preview">
<pre class="js">&nbsp;&nbsp;&lt;WebView&nbsp;Name=<span class="js__string">&quot;WebView&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Margin=<span class="js__string">&quot;100&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NavigationCompleted=<span class="js__string">&quot;WebView_OnNavigationCompleted&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptNotify=<span class="js__string">&quot;WebView_OnScriptNotify&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source=<span class="js__string">&quot;ms-appx-web:///HtmlPage.html&quot;</span>&nbsp;/&gt;</pre>
</div>
</div>
</div>
<div class="endscriptcode">
<p>And in code behind, we need define the NavigationCompleted event handler as following:</p>
</div>
<div class="endscriptcode"></div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">  private async void WebView_OnNavigationCompleted(WebView sender, WebViewNavigationCompletedEventArgs args)
        {
            await WebView.InvokeScriptAsync(&quot;eval&quot;, new[]
            {
                &quot;var signButton=document.getElementById(\&quot;MyButton\&quot;);&quot; &#43;
                &quot;if (signButton.addEventListener) {&quot; &#43;
                    &quot;signButton.addEventListener(\&quot;click\&quot;, MyButtonClicked, false);&quot; &#43;
                &quot;} else {&quot; &#43;
                    &quot;signButton.attachEvent('onclick', MyButtonClicked);&quot; &#43;
                &quot;}  &quot; &#43;
                &quot;function MyButtonClicked(){&quot; &#43;
                    &quot; window.external.notify('%%' &#43; location.href);&quot;&#43;
                 &quot;}&quot;
            });
        }</pre>
<div class="preview">
<pre class="js">&nbsp;&nbsp;private&nbsp;async&nbsp;<span class="js__operator">void</span>&nbsp;WebView_OnNavigationCompleted(WebView&nbsp;sender,&nbsp;WebViewNavigationCompletedEventArgs&nbsp;args)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__brace">{</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await&nbsp;WebView.InvokeScriptAsync(<span class="js__string">&quot;eval&quot;</span>,&nbsp;<span class="js__operator">new</span>[]&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__brace">{</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;var&nbsp;signButton=document.getElementById(\&quot;MyButton\&quot;);&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;if&nbsp;(signButton.addEventListener)&nbsp;{&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;signButton.addEventListener(\&quot;click\&quot;,&nbsp;MyButtonClicked,&nbsp;false);&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;}&nbsp;else&nbsp;{&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;signButton.attachEvent('onclick',&nbsp;MyButtonClicked);&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;}&nbsp;&nbsp;&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;function&nbsp;MyButtonClicked(){&quot;</span>&nbsp;&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;&nbsp;window.external.notify('%%'&nbsp;&#43;&nbsp;location.href);&quot;</span>&#43;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__string">&quot;}&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__brace">}</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__brace">}</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">
<p>Here we are injecting JavaScript code to the web page, that will add the event click to the &quot;MyButton&quot; button defined in the html page. Each time the click event is fired the function &quot;MyButtonClicked&quot; will be called and it will fire the ScriptNotify&nbsp;event
 providing the url.&nbsp;</p>
<p>Now, we need to define the WebView's&nbsp;ScriptNotify&nbsp;event handler as following</p>
</div>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden"> private void WebView_OnScriptNotify(object sender, NotifyEventArgs e)
{
   var url = e.Value;
}</pre>
<div class="preview">
<pre class="js">&nbsp;private&nbsp;<span class="js__operator">void</span>&nbsp;WebView_OnScriptNotify(object&nbsp;sender,&nbsp;NotifyEventArgs&nbsp;e)&nbsp;
<span class="js__brace">{</span>&nbsp;
&nbsp;&nbsp;&nbsp;<span class="js__statement">var</span>&nbsp;url&nbsp;=&nbsp;e.Value;&nbsp;
<span class="js__brace">}</span></pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;The event handler is fired and the url value is set.</div>
<div class="endscriptcode"></div>
<h1>Running the application</h1>
<p>&nbsp;</p>
<div class="entry-content">
<p><img src="description/webview1.jpg" alt="The webview" width="584" height="328"></p>
<p>&nbsp;</p>
<p>And clicking in the button we will get the url value, as we can see in the following image:</p>
<p>&nbsp;</p>
<p><img src="description/webview2.jpg" alt="The webview's scriptnotify event handler" width="584" height="114"></p>
</div>
<p>&nbsp;</p>
<h1><span>Source Code Files</span></h1>
<ul>
<li><em><strong>HtmlPage.html </strong>- define the HTML page to dispaly in the WebView.</em>
</li><li><em><em><strong>MainPage.xaml</strong> - define the Xaml page that show the WebView.</em></em>
</li></ul>
<h1>More Information</h1>
<p><em><em><em>Ask me on twitter&nbsp;<em><em><a href="https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://twitter.com/saramgsilva">@saramgsilva</a></em></em></em></em></em></p>
<p>&nbsp;</p>
<h1>Follow me</h1>
<blockquote>
<p><a href="http://www.saramgsilva.com/">My blog: typeof(saramgsilva)</a></p>
<p><a href="https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://code.msdn.microsoft.com/Invoke-ScriptNotify-event-4e9e13a4/https://twitter.com/saramgsilva">My twitter @saramgsilva</a></p>
</blockquote>
<p><em><em><em><em><em><br>
</em></em></em></em></em></p>
<p><a title="shopify analytics tool" href="http://statcounter.com/shopify/" ><img src="description/.html" alt="shopify analytics tool" style="border:none"></a></p>

</div>


    </div>
</body>
</html>
